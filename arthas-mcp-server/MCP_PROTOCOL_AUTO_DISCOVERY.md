# MCP åè®®è‡ªåŠ¨å‘ç°æœºåˆ¶ - ä¸ºä»€ä¹ˆ Cherry Studio èƒ½è‡ªåŠ¨è¯†åˆ« Arthas MCP æœåŠ¡

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **åˆ›å»ºæ—¥æœŸ**: 2026-01-19
- **ç‰ˆæœ¬**: v1.0
- **ä½œè€…**: Arthas Team
- **ç›®çš„**: è§£é‡Š MCP åè®®çš„æ ‡å‡†åŒ–è®¾è®¡å¦‚ä½•å®ç°å·¥å…·çš„è‡ªåŠ¨å‘ç°å’Œè°ƒç”¨

---

## 1. æ ¸å¿ƒé—®é¢˜

**é—®é¢˜**: ä¸ºä»€ä¹ˆå®ç°äº† MCP åè®®åï¼Œåƒ Cherry Studio è¿™æ ·çš„ AI å®¢æˆ·ç«¯å°±èƒ½è‡ªåŠ¨çŸ¥é“å¦‚ä½•ä½¿ç”¨ Arthas MCP æœåŠ¡ï¼Ÿ

**ç­”æ¡ˆ**: å› ä¸º MCP (Model Context Protocol) æ˜¯ä¸€ä¸ª**æ ‡å‡†åŒ–åè®®**ï¼Œå®ƒå®šä¹‰äº†ï¼š
1. **ç»Ÿä¸€çš„é€šä¿¡æ ¼å¼** (JSON-RPC 2.0)
2. **æ ‡å‡†çš„æ¡æ‰‹æµç¨‹** (initialize/initialized)
3. **è‡ªæè¿°çš„å·¥å…·å‘ç°æœºåˆ¶** (tools/list)
4. **è§„èŒƒçš„å·¥å…·è°ƒç”¨æ¥å£** (tools/call)

å°±åƒ HTTP åè®®ä¸€æ ·ï¼Œä»»ä½•éµå¾ª MCP åè®®çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½èƒ½äº’ç›¸é€šä¿¡ï¼Œæ— éœ€äº‹å…ˆçº¦å®šã€‚

---

## 2. MCP åè®®çš„æ ‡å‡†åŒ–è®¾è®¡

### 2.1 åè®®è§„èŒƒ

MCP åŸºäºä»¥ä¸‹æ ‡å‡†ï¼š
- **JSON-RPC 2.0**: è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®
- **HTTP/SSE**: ä¼ è¾“å±‚åè®®
- **JSON Schema**: å‚æ•°æè¿°æ ¼å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MCP åè®®æ ˆ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  åº”ç”¨å±‚:  MCP åè®® (å·¥å…·å‘ç°ã€è°ƒç”¨ã€èµ„æºç®¡ç†)                    â”‚
â”‚           â†“                                                     â”‚
â”‚  æ¶ˆæ¯å±‚:  JSON-RPC 2.0 (è¯·æ±‚/å“åº”/é€šçŸ¥)                         â”‚
â”‚           â†“                                                     â”‚
â”‚  ä¼ è¾“å±‚:  HTTP/SSE (è¿æ¥ç®¡ç†ã€æ•°æ®ä¼ è¾“)                          â”‚
â”‚           â†“                                                     â”‚
â”‚  ç½‘ç»œå±‚:  TCP/IP                                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ‡å‡†åŒ–çš„å¥½å¤„

| ç‰¹æ€§ | è¯´æ˜ | ç±»æ¯” |
|------|------|------|
| **äº’æ“ä½œæ€§** | ä»»ä½• MCP å®¢æˆ·ç«¯éƒ½èƒ½è¿æ¥ä»»ä½• MCP æœåŠ¡ç«¯ | å°±åƒä»»ä½•æµè§ˆå™¨éƒ½èƒ½è®¿é—®ä»»ä½•ç½‘ç«™ |
| **è‡ªæè¿°** | æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯è‡ªå·±æœ‰ä»€ä¹ˆèƒ½åŠ› | å°±åƒ OpenAPI/Swagger æ–‡æ¡£ |
| **ç‰ˆæœ¬åå•†** | å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åå•†ä½¿ç”¨çš„åè®®ç‰ˆæœ¬ | å°±åƒ HTTP/1.1 vs HTTP/2 |
| **æ‰©å±•æ€§** | å¯ä»¥æ·»åŠ æ–°åŠŸèƒ½è€Œä¸ç ´åå…¼å®¹æ€§ | å°±åƒ HTTP å¤´å¯ä»¥è‡ªå®šä¹‰ |

---

## 3. è‡ªåŠ¨å‘ç°æœºåˆ¶è¯¦è§£

### 3.1 å®Œæ•´çš„äº¤äº’æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cherry Studio   â”‚                                â”‚  Arthas MCP      â”‚
â”‚  (MCP å®¢æˆ·ç«¯)    â”‚                                â”‚  (MCP æœåŠ¡ç«¯)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                                   â”‚
         â”‚  æ­¥éª¤ 1: å»ºç«‹è¿æ¥                                  â”‚
         â”‚  POST /mcp                                        â”‚
         â”‚  {method: "initialize", params: {...}}            â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                                   â”‚
         â”‚  æ­¥éª¤ 2: æœåŠ¡ç«¯è¿”å›èƒ½åŠ›å£°æ˜                        â”‚
         â”‚  {result: {                                       â”‚
         â”‚    protocolVersion: "2025-03-26",                 â”‚
         â”‚    capabilities: {tools: {...}},                  â”‚
         â”‚    serverInfo: {name: "arthas-mcp-server"}        â”‚
         â”‚  }}                                               â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                                   â”‚
         â”‚  æ­¥éª¤ 3: å®¢æˆ·ç«¯ç¡®è®¤åˆå§‹åŒ–å®Œæˆ                      â”‚
         â”‚  {method: "notifications/initialized"}            â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                                   â”‚
         â”‚  æ­¥éª¤ 4: å®¢æˆ·ç«¯è¯·æ±‚å·¥å…·åˆ—è¡¨                        â”‚
         â”‚  {method: "tools/list"}                           â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                                   â”‚
         â”‚  æ­¥éª¤ 5: æœåŠ¡ç«¯è¿”å›æ‰€æœ‰å¯ç”¨å·¥å…·                    â”‚
         â”‚  {result: {tools: [                               â”‚
         â”‚    {                                              â”‚
         â”‚      name: "thread",                              â”‚
         â”‚      description: "æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯åŠå †æ ˆ",            â”‚
         â”‚      inputSchema: {                               â”‚
         â”‚        type: "object",                            â”‚
         â”‚        properties: {                              â”‚
         â”‚          threadId: {type: "integer", ...},        â”‚
         â”‚          topN: {type: "integer", ...}             â”‚
         â”‚        }                                          â”‚
         â”‚      }                                            â”‚
         â”‚    },                                             â”‚
         â”‚    {name: "jvm", ...},                            â”‚
         â”‚    {name: "memory", ...}                          â”‚
         â”‚  ]}}                                              â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                                   â”‚
         â”‚  æ­¥éª¤ 6: å®¢æˆ·ç«¯è°ƒç”¨å…·ä½“å·¥å…·                        â”‚
         â”‚  {method: "tools/call", params: {                 â”‚
         â”‚    name: "thread",                                â”‚
         â”‚    arguments: {topN: 5}                           â”‚
         â”‚  }}                                               â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                                                   â”‚
         â”‚  æ­¥éª¤ 7: æœåŠ¡ç«¯è¿”å›æ‰§è¡Œç»“æœ                        â”‚
         â”‚  {result: {content: [{                            â”‚
         â”‚    type: "text",                                  â”‚
         â”‚    text: "çº¿ç¨‹ä¿¡æ¯: ..."                          â”‚
         â”‚  }]}}                                             â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                                                   â”‚
```

### 3.2 å…³é”®æ­¥éª¤è§£æ

#### æ­¥éª¤ 1-3: æ¡æ‰‹åå•†

**ç›®çš„**: å»ºç«‹è¿æ¥ï¼Œåå•†åè®®ç‰ˆæœ¬å’Œèƒ½åŠ›

**å®¢æˆ·ç«¯å‘é€**:
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "initialize",
  "params": {
    "protocolVersion": "2025-03-26",
    "capabilities": {},
    "clientInfo": {
      "name": "cherry-studio",
      "version": "1.0.0"
    }
  }
}
```

**æœåŠ¡ç«¯å“åº”**:
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "protocolVersion": "2025-03-26",
    "capabilities": {
      "tools": {
        "listChanged": true
      },
      "resources": {
        "subscribe": false,
        "listChanged": true
      },
      "prompts": {
        "listChanged": true
      }
    },
    "serverInfo": {
      "name": "arthas-mcp-server",
      "version": "4.1.5"
    }
  }
}
```

**å…³é”®ä¿¡æ¯**:
- `protocolVersion`: åŒæ–¹ä½¿ç”¨çš„åè®®ç‰ˆæœ¬
- `capabilities`: æœåŠ¡ç«¯æ”¯æŒçš„åŠŸèƒ½ï¼ˆå·¥å…·ã€èµ„æºã€æç¤ºè¯ï¼‰
- `serverInfo`: æœåŠ¡ç«¯èº«ä»½ä¿¡æ¯

#### æ­¥éª¤ 4-5: å·¥å…·å‘ç°ï¼ˆæ ¸å¿ƒæœºåˆ¶ï¼‰

**å®¢æˆ·ç«¯è¯·æ±‚**:
```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "tools/list"
}
```

**æœåŠ¡ç«¯å“åº”**:
```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "tools": [
      {
        "name": "thread",
        "description": "Thread è¯Šæ–­å·¥å…·: æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯åŠå †æ ˆ",
        "inputSchema": {
          "type": "object",
          "properties": {
            "threadId": {
              "type": "integer",
              "description": "çº¿ç¨‹ ID"
            },
            "topN": {
              "type": "integer",
              "description": "æœ€å¿™å‰ N ä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆ"
            },
            "blocking": {
              "type": "boolean",
              "description": "æ˜¯å¦æŸ¥æ‰¾é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹"
            },
            "all": {
              "type": "boolean",
              "description": "æ˜¯å¦æ˜¾ç¤ºæ‰€æœ‰åŒ¹é…çº¿ç¨‹"
            }
          },
          "required": []
        }
      },
      {
        "name": "jvm",
        "description": "JVM ä¿¡æ¯æŸ¥çœ‹å·¥å…·",
        "inputSchema": {
          "type": "object",
          "properties": {}
        }
      },
      {
        "name": "memory",
        "description": "å†…å­˜ä¿¡æ¯æŸ¥çœ‹å·¥å…·",
        "inputSchema": {
          "type": "object",
          "properties": {}
        }
      }
    ]
  }
}
```

**å…³é”®ä¿¡æ¯**:
- `name`: å·¥å…·çš„å”¯ä¸€æ ‡è¯†ç¬¦
- `description`: å·¥å…·çš„åŠŸèƒ½æè¿°ï¼ˆAI å¯ä»¥ç†è§£ï¼‰
- `inputSchema`: å·¥å…·çš„å‚æ•°å®šä¹‰ï¼ˆJSON Schema æ ¼å¼ï¼‰
  - `type`: å‚æ•°ç±»å‹
  - `properties`: æ¯ä¸ªå‚æ•°çš„è¯¦ç»†å®šä¹‰
  - `required`: å¿…å¡«å‚æ•°åˆ—è¡¨

#### æ­¥éª¤ 6-7: å·¥å…·è°ƒç”¨

**å®¢æˆ·ç«¯è¯·æ±‚**:
```json
{
  "jsonrpc": "2.0",
  "id": 3,
  "method": "tools/call",
  "params": {
    "name": "thread",
    "arguments": {
      "topN": 5
    }
  }
}
```

**æœåŠ¡ç«¯å“åº”**:
```json
{
  "jsonrpc": "2.0",
  "id": 3,
  "result": {
    "content": [
      {
        "type": "text",
        "text": "Threads Total: 42, NEW: 0, RUNNABLE: 10, BLOCKED: 0, WAITING: 30, TIMED_WAITING: 2, TERMINATED: 0\n\nTop 5 busy threads:\n1. Thread-1 (CPU: 45.2%)\n   at java.lang.Thread.run(Thread.java:748)\n..."
      }
    ],
    "isError": false
  }
}
```

---

## 4. Arthas MCP æœåŠ¡çš„å®ç°

### 4.1 å·¥å…·å®šä¹‰ï¼ˆæœåŠ¡ç«¯ï¼‰

ä»¥ `ThreadTool` ä¸ºä¾‹ï¼š

```java
@Tool(
    name = "thread",
    description = "Thread è¯Šæ–­å·¥å…·: æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯åŠå †æ ˆï¼Œå¯¹åº” Arthas çš„ thread å‘½ä»¤ã€‚"
)
public String thread(
        @ToolParam(description = "çº¿ç¨‹ ID", required = false)
        Long threadId,

        @ToolParam(description = "æœ€å¿™å‰ N ä¸ªçº¿ç¨‹å¹¶æ‰“å°å †æ ˆ (-n)", required = false)
        Integer topN,

        @ToolParam(description = "æ˜¯å¦æŸ¥æ‰¾é˜»å¡å…¶ä»–çº¿ç¨‹çš„çº¿ç¨‹ (-b)", required = false)
        Boolean blocking,

        @ToolParam(description = "æ˜¯å¦æ˜¾ç¤ºæ‰€æœ‰åŒ¹é…çº¿ç¨‹ (--all)", required = false)
        Boolean all,

        ToolContext toolContext
) {
    // æ‰§è¡Œ Arthas thread å‘½ä»¤
    StringBuilder cmd = buildCommand("thread");
    addFlag(cmd, "-b", blocking);
    if (topN != null && topN > 0) {
        cmd.append(" -n ").append(topN);
    }
    addFlag(cmd, "--all", all);
    if (threadId != null && threadId > 0) {
        cmd.append(" ").append(threadId);
    }
    
    return executeSync(toolContext, cmd.toString());
}
```

**å…³é”®ç‚¹**:
1. `@Tool` æ³¨è§£å®šä¹‰å·¥å…·åç§°å’Œæè¿°
2. `@ToolParam` æ³¨è§£å®šä¹‰æ¯ä¸ªå‚æ•°çš„æè¿°å’Œæ˜¯å¦å¿…å¡«
3. æ–¹æ³•å‚æ•°è‡ªåŠ¨æ˜ å°„ä¸º JSON Schema

### 4.2 å·¥å…·åˆ—è¡¨ç”Ÿæˆï¼ˆè‡ªåŠ¨åŒ–ï¼‰

```java
private CompletableFuture<Object> handleToolsList(McpSchema.JSONRPCRequest request) {
    List<McpSchema.Tool> tools = new ArrayList<>();
    
    // éå†æ‰€æœ‰å·²æ³¨å†Œçš„å·¥å…·å›è°ƒ
    for (ToolCallback callback : toolCallbacks.values()) {
        if (callback.getToolDefinition() != null) {
            // è‡ªåŠ¨ç”Ÿæˆå·¥å…·å®šä¹‰
            McpSchema.Tool tool = new McpSchema.Tool(
                    callback.getToolDefinition().getName(),
                    callback.getToolDefinition().getDescription(),
                    callback.getToolDefinition().getInputSchema()
            );
            tools.add(tool);
        }
    }
    
    McpSchema.ListToolsResult result = new McpSchema.ListToolsResult(tools, null);
    return CompletableFuture.completedFuture(result);
}
```

**å…³é”®ç‚¹**:
1. å·¥å…·å®šä¹‰æ˜¯**è‡ªåŠ¨ç”Ÿæˆ**çš„ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™
2. é€šè¿‡åå°„å’Œæ³¨è§£æ‰«æï¼Œè‡ªåŠ¨æå–å·¥å…·ä¿¡æ¯
3. è¿”å›æ ‡å‡†çš„ MCP æ ¼å¼

### 4.3 å·¥å…·è°ƒç”¨å¤„ç†

```java
private CompletableFuture<Object> handleToolsCall(JSONRPCRequest request) {
    return CompletableFuture.supplyAsync(() -> {
        // 1. è§£æè¯·æ±‚å‚æ•°
        CallToolRequest callRequest = objectMapper.convertValue(
            request.getParams(), CallToolRequest.class);
        
        String toolName = callRequest.getName();
        Map<String, Object> arguments = callRequest.getArguments();
        
        // 2. æŸ¥æ‰¾å·¥å…·å›è°ƒ
        ToolCallback callback = toolCallbacks.get(toolName);
        if (callback == null) {
            throw new IllegalArgumentException("Tool not found: " + toolName);
        }
        
        // 3. æ„å»ºå·¥å…·è¾“å…¥ï¼ˆJSON å­—ç¬¦ä¸²ï¼‰
        String toolInput = objectMapper.writeValueAsString(arguments);
        
        // 4. æ„å»ºå·¥å…·ä¸Šä¸‹æ–‡
        ToolContext toolContext = new ToolContext(callRequest.meta());
        
        // 5. æ‰§è¡Œå·¥å…·ï¼ˆè°ƒç”¨å®é™…çš„ Arthas å‘½ä»¤ï¼‰
        String result = callback.call(toolInput, toolContext);
        
        // 6. æ„é€ æ ‡å‡†å“åº”
        return CallToolResult.builder()
            .addTextContent(result)
            .isError(false)
            .build();
    });
}
```

---

## 5. Cherry Studio å¦‚ä½•ä½¿ç”¨ Arthas MCP

### 5.1 Cherry Studio çš„å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Cherry Studio                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. ç”¨æˆ·é…ç½® MCP æœåŠ¡åœ°å€                                        â”‚
â”‚     http://localhost:8563/mcp                                   â”‚
â”‚                                                                 â”‚
â”‚  2. Cherry Studio è‡ªåŠ¨è¿æ¥å¹¶åˆå§‹åŒ–                              â”‚
â”‚     - å‘é€ initialize è¯·æ±‚                                      â”‚
â”‚     - æ¥æ”¶æœåŠ¡ç«¯èƒ½åŠ›å£°æ˜                                         â”‚
â”‚                                                                 â”‚
â”‚  3. Cherry Studio è‡ªåŠ¨è·å–å·¥å…·åˆ—è¡¨                              â”‚
â”‚     - å‘é€ tools/list è¯·æ±‚                                      â”‚
â”‚     - è§£æå·¥å…·å®šä¹‰ï¼ˆåç§°ã€æè¿°ã€å‚æ•°ï¼‰                           â”‚
â”‚                                                                 â”‚
â”‚  4. Cherry Studio å°†å·¥å…·ä¿¡æ¯æä¾›ç»™ AI                           â”‚
â”‚     - AI ç†è§£æ¯ä¸ªå·¥å…·çš„åŠŸèƒ½                                      â”‚
â”‚     - AI çŸ¥é“æ¯ä¸ªå·¥å…·éœ€è¦ä»€ä¹ˆå‚æ•°                                â”‚
â”‚                                                                 â”‚
â”‚  5. ç”¨æˆ·ä¸ AI å¯¹è¯                                              â”‚
â”‚     ç”¨æˆ·: "å¸®æˆ‘çœ‹ä¸€ä¸‹æœ€å¿™çš„ 5 ä¸ªçº¿ç¨‹"                            â”‚
â”‚                                                                 â”‚
â”‚  6. AI å†³ç­–è°ƒç”¨å·¥å…·                                             â”‚
â”‚     AI åˆ†æ: éœ€è¦ä½¿ç”¨ thread å·¥å…·ï¼Œå‚æ•° topN=5                  â”‚
â”‚                                                                 â”‚
â”‚  7. Cherry Studio æ‰§è¡Œå·¥å…·è°ƒç”¨                                  â”‚
â”‚     - å‘é€ tools/call è¯·æ±‚                                      â”‚
â”‚     - æ¥æ”¶æ‰§è¡Œç»“æœ                                               â”‚
â”‚                                                                 â”‚
â”‚  8. AI è§£è¯»ç»“æœå¹¶å›å¤ç”¨æˆ·                                        â”‚
â”‚     AI: "å½“å‰æœ€å¿™çš„ 5 ä¸ªçº¿ç¨‹æ˜¯..."                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 AI å¦‚ä½•ç†è§£å·¥å…·

Cherry Studio å°†å·¥å…·ä¿¡æ¯è½¬æ¢ä¸º AI å¯ä»¥ç†è§£çš„æ ¼å¼ï¼š

**å·¥å…·å®šä¹‰**:
```json
{
  "name": "thread",
  "description": "Thread è¯Šæ–­å·¥å…·: æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯åŠå †æ ˆ",
  "inputSchema": {
    "type": "object",
    "properties": {
      "threadId": {"type": "integer", "description": "çº¿ç¨‹ ID"},
      "topN": {"type": "integer", "description": "æœ€å¿™å‰ N ä¸ªçº¿ç¨‹"}
    }
  }
}
```

**AI çš„ç†è§£**:
```
å·¥å…·åç§°: thread
åŠŸèƒ½: è¿™æ˜¯ä¸€ä¸ªç”¨äºè¯Šæ–­çº¿ç¨‹çš„å·¥å…·ï¼Œå¯ä»¥æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯å’Œå †æ ˆ
å‚æ•°:
  - threadId (å¯é€‰): æŒ‡å®šè¦æŸ¥çœ‹çš„çº¿ç¨‹ ID
  - topN (å¯é€‰): æŸ¥çœ‹æœ€å¿™çš„å‰ N ä¸ªçº¿ç¨‹

ä½¿ç”¨åœºæ™¯:
  - å½“ç”¨æˆ·é—®"æœ‰å“ªäº›çº¿ç¨‹åœ¨è¿è¡Œ"æ—¶ï¼Œè°ƒç”¨ thread()
  - å½“ç”¨æˆ·é—®"æœ€å¿™çš„çº¿ç¨‹æ˜¯å“ªäº›"æ—¶ï¼Œè°ƒç”¨ thread(topN=5)
  - å½“ç”¨æˆ·é—®"çº¿ç¨‹ 123 åœ¨åšä»€ä¹ˆ"æ—¶ï¼Œè°ƒç”¨ thread(threadId=123)
```

### 5.3 ä¸ºä»€ä¹ˆä¸éœ€è¦äº‹å…ˆé…ç½®

**ä¼ ç»Ÿæ–¹å¼**ï¼ˆéœ€è¦äº‹å…ˆé…ç½®ï¼‰:
```yaml
# éœ€è¦æ‰‹åŠ¨ç¼–å†™é…ç½®æ–‡ä»¶
tools:
  - name: thread
    endpoint: http://localhost:8563/api/thread
    method: POST
    parameters:
      - name: threadId
        type: integer
      - name: topN
        type: integer
```

**MCP æ–¹å¼**ï¼ˆè‡ªåŠ¨å‘ç°ï¼‰:
```
1. åªéœ€è¦é…ç½®ä¸€ä¸ª MCP æœåŠ¡åœ°å€
2. æ‰€æœ‰å·¥å…·ä¿¡æ¯é€šè¿‡ tools/list è‡ªåŠ¨è·å–
3. å·¥å…·å®šä¹‰åŒ…å«å®Œæ•´çš„å‚æ•°æè¿°
4. AI å¯ä»¥ç›´æ¥ç†è§£å’Œä½¿ç”¨
```

---

## 6. æ ‡å‡†åŒ–çš„ä»·å€¼

### 6.1 å¯¹æœåŠ¡æä¾›è€…ï¼ˆArthasï¼‰

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **ä¸€æ¬¡å®ç°ï¼Œåˆ°å¤„å¯ç”¨** | å®ç° MCP åè®®åï¼Œæ‰€æœ‰æ”¯æŒ MCP çš„å®¢æˆ·ç«¯éƒ½èƒ½ä½¿ç”¨ |
| **è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ** | å·¥å…·å®šä¹‰å³æ–‡æ¡£ï¼Œæ— éœ€å•ç‹¬ç»´æŠ¤ API æ–‡æ¡£ |
| **ç‰ˆæœ¬å…¼å®¹** | åè®®æ”¯æŒç‰ˆæœ¬åå•†ï¼Œå¯ä»¥å¹³æ»‘å‡çº§ |
| **ç”Ÿæ€é›†æˆ** | å¯ä»¥è¢«é›†æˆåˆ°å„ç§ AI å·¥å…·å’Œå¹³å° |

### 6.2 å¯¹å®¢æˆ·ç«¯ï¼ˆCherry Studioï¼‰

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **é›¶é…ç½®æ¥å…¥** | åªéœ€è¦ä¸€ä¸ª URLï¼Œæ— éœ€äº†è§£å…·ä½“å·¥å…· |
| **åŠ¨æ€å‘ç°** | æœåŠ¡ç«¯æ·»åŠ æ–°å·¥å…·ï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨å¯ç”¨ |
| **æ ‡å‡†åŒ–äº¤äº’** | ç»Ÿä¸€çš„è°ƒç”¨æ–¹å¼ï¼Œé™ä½å¼€å‘æˆæœ¬ |
| **AI å‹å¥½** | å·¥å…·æè¿°å¯ä»¥ç›´æ¥è¢« AI ç†è§£ |

### 6.3 å¯¹ç”¨æˆ·

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **æ— ç¼ä½“éªŒ** | ä¸éœ€è¦å­¦ä¹ å¤æ‚çš„å‘½ä»¤å’Œå‚æ•° |
| **è‡ªç„¶äº¤äº’** | ç”¨è‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚ï¼ŒAI è‡ªåŠ¨è°ƒç”¨å·¥å…· |
| **åŠŸèƒ½å‘ç°** | AI å¯ä»¥ä¸»åŠ¨å»ºè®®å¯ç”¨çš„è¯Šæ–­å·¥å…· |
| **è·¨å·¥å…·é›†æˆ** | å¯ä»¥åœ¨ä¸€ä¸ªå¯¹è¯ä¸­ä½¿ç”¨å¤šä¸ª MCP æœåŠ¡ |

---

## 7. ç±»æ¯”ï¼šMCP å°±åƒ USB åè®®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USB åè®®ç±»æ¯”                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  USB è®¾å¤‡ï¼ˆæœåŠ¡ç«¯ï¼‰                MCP æœåŠ¡ï¼ˆArthasï¼‰            â”‚
â”‚  â”œâ”€ æ’å…¥ç”µè„‘                       â”œâ”€ å¯åŠ¨ MCP æœåŠ¡             â”‚
â”‚  â”œâ”€ è‡ªåŠ¨è¯†åˆ«è®¾å¤‡ç±»å‹                â”œâ”€ è¿”å› capabilities        â”‚
â”‚  â”œâ”€ å‘Šè¯‰ç”µè„‘è‡ªå·±çš„åŠŸèƒ½              â”œâ”€ è¿”å› tools/list          â”‚
â”‚  â””â”€ ç”µè„‘å¯ä»¥ç›´æ¥ä½¿ç”¨                â””â”€ AI å¯ä»¥ç›´æ¥è°ƒç”¨          â”‚
â”‚                                                                 â”‚
â”‚  ä¸ºä»€ä¹ˆä»»ä½• USB è®¾å¤‡éƒ½èƒ½è¢«è¯†åˆ«ï¼Ÿ                                 â”‚
â”‚  â†’ å› ä¸º USB æ˜¯æ ‡å‡†åŒ–åè®®                                        â”‚
â”‚                                                                 â”‚
â”‚  ä¸ºä»€ä¹ˆä»»ä½• MCP æœåŠ¡éƒ½èƒ½è¢« AI ä½¿ç”¨ï¼Ÿ                             â”‚
â”‚  â†’ å› ä¸º MCP æ˜¯æ ‡å‡†åŒ–åè®®                                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. å®é™…ç¤ºä¾‹ï¼šå®Œæ•´å¯¹è¯æµç¨‹

### 8.1 ç”¨æˆ·ä¸ AI çš„å¯¹è¯

```
ç”¨æˆ·: å¸®æˆ‘çœ‹ä¸€ä¸‹ Java è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ

AI æ€è€ƒè¿‡ç¨‹:
1. åˆ†æç”¨æˆ·æ„å›¾: æŸ¥çœ‹å†…å­˜ä¿¡æ¯
2. æŸ¥æ‰¾å¯ç”¨å·¥å…·: å‘ç° memory å·¥å…·
3. æ£€æŸ¥å·¥å…·æè¿°: "å†…å­˜ä¿¡æ¯æŸ¥çœ‹å·¥å…·"
4. ç¡®è®¤å‚æ•°: æ— éœ€å‚æ•°
5. å†³å®šè°ƒç”¨: memory()

Cherry Studio æ‰§è¡Œ:
1. å‘é€ tools/call è¯·æ±‚
2. æ¥æ”¶æ‰§è¡Œç»“æœ
3. å°†ç»“æœè¿”å›ç»™ AI

AI å›å¤:
"å½“å‰ JVM å†…å­˜ä½¿ç”¨æƒ…å†µå¦‚ä¸‹ï¼š
- å †å†…å­˜: 512MB / 2GB (25%)
- éå †å†…å­˜: 128MB / 256MB (50%)
- Eden åŒº: 100MB / 512MB
- Old åŒº: 300MB / 1GB
..."
```

### 8.2 å®é™…çš„ç½‘ç»œè¯·æ±‚

**1. å·¥å…·åˆ—è¡¨è¯·æ±‚**:
```http
POST /mcp HTTP/1.1
Content-Type: application/json

{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "tools/list"
}
```

**2. å·¥å…·åˆ—è¡¨å“åº”**:
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "tools": [
      {
        "name": "memory",
        "description": "å†…å­˜ä¿¡æ¯æŸ¥çœ‹å·¥å…·",
        "inputSchema": {
          "type": "object",
          "properties": {}
        }
      },
      ...
    ]
  }
}
```

**3. å·¥å…·è°ƒç”¨è¯·æ±‚**:
```http
POST /mcp HTTP/1.1
Content-Type: application/json

{
  "jsonrpc": "2.0",
  "id": 3,
  "method": "tools/call",
  "params": {
    "name": "memory",
    "arguments": {}
  }
}
```

**4. å·¥å…·è°ƒç”¨å“åº”**:
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "jsonrpc": "2.0",
  "id": 3,
  "result": {
    "content": [
      {
        "type": "text",
        "text": "Memory\nheap: 512MB/2GB (25%)\nnon-heap: 128MB/256MB (50%)\n..."
      }
    ],
    "isError": false
  }
}
```

---

## 9. æ€»ç»“

### 9.1 æ ¸å¿ƒè¦ç‚¹

1. **MCP æ˜¯æ ‡å‡†åŒ–åè®®**
   - å®šä¹‰äº†ç»Ÿä¸€çš„é€šä¿¡æ ¼å¼
   - è§„èŒƒäº†å·¥å…·å‘ç°å’Œè°ƒç”¨æµç¨‹
   - æ”¯æŒè‡ªæè¿°å’Œç‰ˆæœ¬åå•†

2. **è‡ªåŠ¨å‘ç°æœºåˆ¶**
   - `initialize`: æ¡æ‰‹å’Œèƒ½åŠ›åå•†
   - `tools/list`: è·å–æ‰€æœ‰å¯ç”¨å·¥å…·
   - `tools/call`: è°ƒç”¨å…·ä½“å·¥å…·

3. **AI å‹å¥½è®¾è®¡**
   - å·¥å…·æè¿°ä½¿ç”¨è‡ªç„¶è¯­è¨€
   - å‚æ•°å®šä¹‰ä½¿ç”¨ JSON Schema
   - AI å¯ä»¥ç›´æ¥ç†è§£å’Œä½¿ç”¨

4. **é›¶é…ç½®æ¥å…¥**
   - å®¢æˆ·ç«¯åªéœ€è¦ä¸€ä¸ª URL
   - æ‰€æœ‰ä¿¡æ¯é€šè¿‡åè®®è‡ªåŠ¨è·å–
   - æœåŠ¡ç«¯æ›´æ–°ï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨æ„ŸçŸ¥

### 9.2 ä¸ºä»€ä¹ˆ Cherry Studio èƒ½è‡ªåŠ¨è¯†åˆ«

```
Cherry Studio èƒ½è‡ªåŠ¨è¯†åˆ« Arthas MCP æœåŠ¡ï¼Œæ˜¯å› ä¸ºï¼š

1. åŒæ–¹éƒ½éµå¾ª MCP æ ‡å‡†åè®®
   â”œâ”€ Cherry Studio çŸ¥é“å¦‚ä½•å‘é€ tools/list è¯·æ±‚
   â””â”€ Arthas MCP çŸ¥é“å¦‚ä½•è¿”å›å·¥å…·åˆ—è¡¨

2. å·¥å…·å®šä¹‰æ˜¯è‡ªæè¿°çš„
   â”œâ”€ åŒ…å«å·¥å…·åç§°å’ŒåŠŸèƒ½æè¿°
   â”œâ”€ åŒ…å«å‚æ•°å®šä¹‰å’Œç±»å‹
   â””â”€ AI å¯ä»¥ç›´æ¥ç†è§£

3. è°ƒç”¨æ¥å£æ˜¯æ ‡å‡†åŒ–çš„
   â”œâ”€ ç»Ÿä¸€ä½¿ç”¨ tools/call æ–¹æ³•
   â”œâ”€ å‚æ•°æ ¼å¼ç»Ÿä¸€ï¼ˆJSONï¼‰
   â””â”€ å“åº”æ ¼å¼ç»Ÿä¸€ï¼ˆcontent æ•°ç»„ï¼‰

å°±åƒï¼š
- ä»»ä½•æµè§ˆå™¨éƒ½èƒ½è®¿é—®ä»»ä½•ç½‘ç«™ï¼ˆHTTP åè®®ï¼‰
- ä»»ä½• USB è®¾å¤‡éƒ½èƒ½è¢«ç”µè„‘è¯†åˆ«ï¼ˆUSB åè®®ï¼‰
- ä»»ä½• MCP å®¢æˆ·ç«¯éƒ½èƒ½ä½¿ç”¨ä»»ä½• MCP æœåŠ¡ï¼ˆMCP åè®®ï¼‰
```

### 9.3 Arthas MCP çš„ä¼˜åŠ¿

é€šè¿‡å®ç° MCP åè®®ï¼ŒArthas è·å¾—äº†ï¼š

1. **å¹¿æ³›çš„å®¢æˆ·ç«¯æ”¯æŒ**
   - Cherry Studio
   - Claude Desktop
   - å…¶ä»–æ”¯æŒ MCP çš„ AI å·¥å…·

2. **è‡ªç„¶è¯­è¨€äº¤äº’**
   - ç”¨æˆ·æ— éœ€è®°å¿†å‘½ä»¤
   - AI è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å·¥å…·
   - é™ä½ä½¿ç”¨é—¨æ§›

3. **ç”Ÿæ€é›†æˆ**
   - å¯ä»¥ä¸å…¶ä»– MCP æœåŠ¡ç»„åˆä½¿ç”¨
   - ç»Ÿä¸€çš„å·¥å…·ç®¡ç†
   - æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

---

## 10. Arthas çš„æ··åˆ MCP æ¶æ„è®¾è®¡

### 10.1 æ¶æ„æ¼”è¿›

#### ä¼ ç»Ÿ MCP æ¶æ„ï¼ˆå•ä½“ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cherry Studio (MCP å®¢æˆ·ç«¯)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ MCP åè®®
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Arthas MCP Server (å•ä½“æœåŠ¡)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… Tools (è¯Šæ–­èƒ½åŠ›)                                             â”‚
â”‚     - thread, jvm, memory, dashboard...                         â”‚
â”‚                                                                 â”‚
â”‚  âœ… Prompts (è¯Šæ–­æµç¨‹)                                           â”‚
â”‚     - å†…å­˜æ³„æ¼è¯Šæ–­æµç¨‹                                           â”‚
â”‚     - CPU é£™é«˜è¯Šæ–­æµç¨‹                                           â”‚
â”‚                                                                 â”‚
â”‚  âœ… Resources (çŸ¥è¯†åº“)                                           â”‚
â”‚     - Arthas å‘½ä»¤æ–‡æ¡£                                            â”‚
â”‚     - è¯Šæ–­æ¡ˆä¾‹åº“                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜**ï¼š
- æ‰€æœ‰åŠŸèƒ½è€¦åˆåœ¨ä¸€èµ·
- Prompts/Resources éœ€è¦éš Arthas éƒ¨ç½²
- æ— æ³•é›†ä¸­ç®¡ç†è¯Šæ–­çŸ¥è¯†

#### Arthas æ··åˆ MCP æ¶æ„ï¼ˆæ¨èï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cherry Studio (MCP å®¢æˆ·ç«¯)                    â”‚
â”‚                                                                 â”‚
â”‚  ç‰¹æ€§ï¼šå¯ä»¥åŒæ—¶è¿æ¥å¤šä¸ª MCP æœåŠ¡                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                             â”‚
               â”‚ MCP åè®®                     â”‚ MCP åè®®
               â”‚                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Arthas MCP Server         â”‚  â”‚  Remote Agent MCP Server       â”‚
â”‚  (æœ¬åœ°è¯Šæ–­èƒ½åŠ›)             â”‚  â”‚  (è¿œç¨‹çŸ¥è¯†æœåŠ¡)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… Tools (è¯Šæ–­èƒ½åŠ›)        â”‚  â”‚  âœ… Prompts (è¯Šæ–­æµç¨‹)          â”‚
â”‚     - thread               â”‚  â”‚     - å†…å­˜æ³„æ¼è¯Šæ–­æµç¨‹          â”‚
â”‚     - jvm                  â”‚  â”‚     - CPU é£™é«˜è¯Šæ–­æµç¨‹          â”‚
â”‚     - memory               â”‚  â”‚     - çº¿ç¨‹æ­»é”è¯Šæ–­æµç¨‹          â”‚
â”‚     - dashboard            â”‚  â”‚                                â”‚
â”‚     - ...                  â”‚  â”‚  âœ… Resources (çŸ¥è¯†åº“)          â”‚
â”‚                            â”‚  â”‚     - Arthas å‘½ä»¤æ–‡æ¡£           â”‚
â”‚  âŒ Prompts (ç§»é™¤)         â”‚  â”‚     - è¯Šæ–­æ¡ˆä¾‹åº“                â”‚
â”‚  âŒ Resources (ç§»é™¤)       â”‚  â”‚     - æœ€ä½³å®è·µ                  â”‚
â”‚                            â”‚  â”‚     - æ•…éšœæ’æŸ¥æ‰‹å†Œ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                   â”‚
         â”‚                                   â”‚
         â–¼                                   â–¼
    æœ¬åœ° JVM è¿›ç¨‹                      ä¸­å¿ƒåŒ–çŸ¥è¯†åº“
```

### 10.2 æ¶æ„ç‰¹ç‚¹

#### èŒè´£åˆ†ç¦»

| ç»„ä»¶ | èŒè´£ | éƒ¨ç½²ä½ç½® | æ›´æ–°é¢‘ç‡ |
|------|------|----------|----------|
| **Arthas MCP Server** | æä¾›è¯Šæ–­å·¥å…·ï¼ˆToolsï¼‰ | æœ¬åœ°ï¼ˆéš Arthas éƒ¨ç½²ï¼‰ | éš Arthas ç‰ˆæœ¬æ›´æ–° |
| **Remote Agent MCP Server** | æä¾›è¯Šæ–­æµç¨‹ï¼ˆPromptsï¼‰å’ŒçŸ¥è¯†åº“ï¼ˆResourcesï¼‰ | è¿œç¨‹ï¼ˆä¸­å¿ƒåŒ–æœåŠ¡ï¼‰ | å¯ç‹¬ç«‹æ›´æ–° |

#### ä¼˜åŠ¿åˆ†æ

**1. å…³æ³¨ç‚¹åˆ†ç¦»**
```
Arthas æœ¬åœ°ç«¯ï¼š
  ä¸“æ³¨äº "èƒ½åšä»€ä¹ˆ" (What can I do?)
  - æä¾›åŸå­åŒ–çš„è¯Šæ–­èƒ½åŠ›
  - ç›´æ¥æ“ä½œæœ¬åœ° JVM
  - è½»é‡çº§ã€é«˜æ€§èƒ½

Remote Agent ç«¯ï¼š
  ä¸“æ³¨äº "æ€ä¹ˆåš" (How to do it?)
  - æä¾›è¯Šæ–­æµç¨‹å’Œæ–¹æ³•è®º
  - ç§¯ç´¯è¯Šæ–­ç»éªŒå’Œæ¡ˆä¾‹
  - æŒç»­ä¼˜åŒ–å’Œæ›´æ–°
```

**2. ç‹¬ç«‹æ¼”è¿›**
```
Arthas å·¥å…·æ›´æ–°ï¼š
  - æ–°å¢ thread å‘½ä»¤çš„å‚æ•°
  - ä¼˜åŒ– dashboard æ€§èƒ½
  - ä¸å½±å“è¯Šæ–­æµç¨‹

è¯Šæ–­çŸ¥è¯†æ›´æ–°ï¼š
  - æ–°å¢å†…å­˜æ³„æ¼è¯Šæ–­æµç¨‹
  - æ›´æ–°æœ€ä½³å®è·µæ–‡æ¡£
  - ä¸éœ€è¦é‡å¯ Arthas
```

**3. ä¸­å¿ƒåŒ–ç®¡ç†**
```
ä¼ ç»Ÿæ–¹å¼ï¼š
  æ¯ä¸ª Arthas å®ä¾‹éƒ½è¦ç»´æŠ¤ä¸€ä»½ Prompts/Resources
  æ›´æ–°å›°éš¾ï¼Œç‰ˆæœ¬ä¸ä¸€è‡´

æ··åˆæ¶æ„ï¼š
  æ‰€æœ‰ Arthas å®ä¾‹å…±äº«åŒä¸€ä¸ªçŸ¥è¯†åº“
  ç»Ÿä¸€æ›´æ–°ï¼Œç‰ˆæœ¬ä¸€è‡´
```

**4. çµæ´»ç»„åˆ**
```
åœºæ™¯ 1ï¼šæœ¬åœ°å¼€å‘
  - è¿æ¥æœ¬åœ° Arthas MCP Server
  - è¿æ¥å…¬å¸å†…éƒ¨ Agent MCP Server

åœºæ™¯ 2ï¼šç”Ÿäº§ç¯å¢ƒ
  - è¿æ¥ç”Ÿäº§ Arthas MCP Server
  - è¿æ¥å®˜æ–¹ Agent MCP Server

åœºæ™¯ 3ï¼šç¦»çº¿ç¯å¢ƒ
  - åªè¿æ¥æœ¬åœ° Arthas MCP Server
  - ä¸ä¾èµ–è¿œç¨‹æœåŠ¡
```

### 10.3 è¿™ç§æ¶æ„å«ä»€ä¹ˆï¼Ÿ

#### å®˜æ–¹æœ¯è¯­

è¿™ç§æ¶æ„åœ¨ MCP ç”Ÿæ€ä¸­è¢«ç§°ä¸ºï¼š

**Multi-Server MCP Architecture**ï¼ˆå¤šæœåŠ¡å™¨ MCP æ¶æ„ï¼‰

æˆ–è€…

**Federated MCP Architecture**ï¼ˆè”é‚¦å¼ MCP æ¶æ„ï¼‰

#### Arthas ç‰¹å®šæœ¯è¯­

å¯¹äº Arthas é¡¹ç›®ï¼Œå¯ä»¥ç§°ä¸ºï¼š

**Arthas Hybrid MCP Architecture**ï¼ˆArthas æ··åˆ MCP æ¶æ„ï¼‰

æˆ–è€…

**Arthas Distributed MCP Architecture**ï¼ˆArthas åˆ†å¸ƒå¼ MCP æ¶æ„ï¼‰

#### æ¨èå‘½å

```
æ­£å¼åç§°ï¼š
  Arthas Hybrid MCP Architecture
  Arthas æ··åˆ MCP æ¶æ„

ç®€ç§°ï¼š
  Arthas Hybrid MCP

æè¿°ï¼š
  "Arthas é‡‡ç”¨æ··åˆ MCP æ¶æ„ï¼Œå°†è¯Šæ–­èƒ½åŠ›ï¼ˆToolsï¼‰éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œ
   å°†è¯Šæ–­æµç¨‹ï¼ˆPromptsï¼‰å’ŒçŸ¥è¯†åº“ï¼ˆResourcesï¼‰éƒ¨ç½²åœ¨è¿œç¨‹ Agentï¼Œ
   å®ç°å…³æ³¨ç‚¹åˆ†ç¦»å’Œç‹¬ç«‹æ¼”è¿›ã€‚"
```

### 10.4 å®ç°æ–¹å¼

#### Cherry Studio é…ç½®

```json
{
  "mcpServers": {
    "arthas-local": {
      "url": "http://localhost:8563/mcp",
      "description": "æœ¬åœ° Arthas è¯Šæ–­å·¥å…·"
    },
    "arthas-agent": {
      "url": "https://agent.arthas.aliyun.com/mcp",
      "description": "Arthas è¯Šæ–­çŸ¥è¯†åº“"
    }
  }
}
```

#### AI çš„ä½¿ç”¨ä½“éªŒ

```
ç”¨æˆ·: "å¸®æˆ‘è¯Šæ–­ä¸€ä¸‹å†…å­˜æ³„æ¼é—®é¢˜"

AI æ€è€ƒè¿‡ç¨‹:
1. æŸ¥è¯¢ arthas-agent çš„ prompts/list
   â†’ å‘ç° "memory-leak-diagnosis" æµç¨‹

2. è·å– prompts/get (memory-leak-diagnosis)
   â†’ è·å¾—è¯Šæ–­æ­¥éª¤ï¼š
     Step 1: æŸ¥çœ‹å †å†…å­˜ä½¿ç”¨æƒ…å†µ (ä½¿ç”¨ memory å·¥å…·)
     Step 2: æŸ¥çœ‹ GC æƒ…å†µ (ä½¿ç”¨ dashboard å·¥å…·)
     Step 3: åˆ†æå¯¹è±¡å ç”¨ (ä½¿ç”¨ heapdump å·¥å…·)

3. æ‰§è¡Œè¯Šæ–­æµç¨‹ï¼š
   â†’ è°ƒç”¨ arthas-local çš„ memory å·¥å…·
   â†’ è°ƒç”¨ arthas-local çš„ dashboard å·¥å…·
   â†’ è°ƒç”¨ arthas-local çš„ heapdump å·¥å…·

4. å‚è€ƒ arthas-agent çš„ resources
   â†’ è·å–å†…å­˜æ³„æ¼æ¡ˆä¾‹åº“
   â†’ å¯¹æ¯”åˆ†æç»“æœ

5. ç»™å‡ºè¯Šæ–­ç»“è®ºå’Œå»ºè®®
```

### 10.5 æ¶æ„å¯¹æ¯”

#### å•ä½“ MCP vs æ··åˆ MCP

| ç»´åº¦ | å•ä½“ MCP | æ··åˆ MCP |
|------|----------|----------|
| **éƒ¨ç½²å¤æ‚åº¦** | â­ ç®€å• | â­â­ ä¸­ç­‰ |
| **ç»´æŠ¤æˆæœ¬** | â­â­â­ é«˜ | â­ ä½ |
| **çŸ¥è¯†æ›´æ–°** | â­ å›°éš¾ | â­â­â­ å®¹æ˜“ |
| **ç¦»çº¿å¯ç”¨** | â­â­â­ å®Œå…¨å¯ç”¨ | â­â­ éƒ¨åˆ†å¯ç”¨ |
| **æ‰©å±•æ€§** | â­ å·® | â­â­â­ å¥½ |
| **ä¸€è‡´æ€§** | â­ å·® | â­â­â­ å¥½ |

#### é€‚ç”¨åœºæ™¯

**å•ä½“ MCP é€‚åˆ**ï¼š
- ç¦»çº¿ç¯å¢ƒ
- ç®€å•åœºæ™¯
- å¿«é€ŸåŸå‹

**æ··åˆ MCP é€‚åˆ**ï¼š
- ä¼ä¸šçº§åº”ç”¨
- éœ€è¦æŒç»­æ›´æ–°è¯Šæ–­çŸ¥è¯†
- å¤šå›¢é˜Ÿåä½œ
- ä¸­å¿ƒåŒ–ç®¡ç†

### 10.6 è¿ç§»è·¯å¾„

#### ä»å•ä½“åˆ°æ··åˆ

```
é˜¶æ®µ 1: ä¿æŒå…¼å®¹
  â”œâ”€ Arthas MCP Server ç»§ç»­æä¾›æ‰€æœ‰åŠŸèƒ½
  â””â”€ æ–°å¢ Remote Agent MCP Server

é˜¶æ®µ 2: é€æ­¥è¿ç§»
  â”œâ”€ å°† Prompts è¿ç§»åˆ° Remote Agent
  â”œâ”€ å°† Resources è¿ç§»åˆ° Remote Agent
  â””â”€ Arthas MCP Server ä¿ç•™ Tools

é˜¶æ®µ 3: å®Œå…¨åˆ†ç¦»
  â”œâ”€ Arthas MCP Server åªæä¾› Tools
  â”œâ”€ Remote Agent æä¾› Prompts/Resources
  â””â”€ ç§»é™¤ Arthas ä¸­çš„ Prompts/Resources ä»£ç 
```

#### ä»£ç è°ƒæ•´

**Arthas MCP Server**:
```java
// ç§»é™¤ Prompts å’Œ Resources çš„èƒ½åŠ›å£°æ˜
@Override
public InitializeResult initialize(InitializeRequest request) {
    return InitializeResult.builder()
        .protocolVersion(PROTOCOL_VERSION)
        .capabilities(ServerCapabilities.builder()
            .tools(ToolsCapability.builder()
                .listChanged(true)
                .build())
            // ç§»é™¤ prompts å’Œ resources
            .build())
        .serverInfo(Implementation.builder()
            .name("arthas-mcp-server")
            .version(version)
            .build())
        .build();
}
```

**Remote Agent MCP Server**:
```java
// åªæä¾› Prompts å’Œ Resources
@Override
public InitializeResult initialize(InitializeRequest request) {
    return InitializeResult.builder()
        .protocolVersion(PROTOCOL_VERSION)
        .capabilities(ServerCapabilities.builder()
            .prompts(PromptsCapability.builder()
                .listChanged(true)
                .build())
            .resources(ResourcesCapability.builder()
                .subscribe(false)
                .listChanged(true)
                .build())
            // ä¸æä¾› tools
            .build())
        .serverInfo(Implementation.builder()
            .name("arthas-agent-mcp-server")
            .version(version)
            .build())
        .build();
}
```

### 10.7 æ€»ç»“

#### æ ¸å¿ƒç†å¿µ

```
Arthas æ··åˆ MCP æ¶æ„çš„æ ¸å¿ƒç†å¿µï¼š

"å·¥å…·åœ¨æœ¬åœ°ï¼ŒçŸ¥è¯†åœ¨äº‘ç«¯"
(Tools on-premise, Knowledge in the cloud)

æœ¬åœ°æä¾›ï¼š
  âœ… å¿«é€Ÿå“åº”çš„è¯Šæ–­èƒ½åŠ›
  âœ… ç›´æ¥è®¿é—® JVM çš„å·¥å…·
  âœ… è½»é‡çº§éƒ¨ç½²

è¿œç¨‹æä¾›ï¼š
  âœ… æŒç»­æ›´æ–°çš„è¯Šæ–­æµç¨‹
  âœ… ä¸æ–­ç§¯ç´¯çš„æ¡ˆä¾‹åº“
  âœ… ä¸­å¿ƒåŒ–çš„çŸ¥è¯†ç®¡ç†
```

#### ä»ç„¶æ˜¯ MCP

```
é‡è¦ï¼šè¿™ç§æ¶æ„ä»ç„¶å®Œå…¨éµå¾ª MCP åè®®

âœ… æ¯ä¸ªæœåŠ¡éƒ½æ˜¯æ ‡å‡†çš„ MCP Server
âœ… å®¢æˆ·ç«¯ä½¿ç”¨æ ‡å‡†çš„ MCP åè®®è¿æ¥
âœ… å·¥å…·å‘ç°å’Œè°ƒç”¨æœºåˆ¶ä¸å˜
âœ… å¯ä»¥ä¸å…¶ä»– MCP æœåŠ¡äº’æ“ä½œ

åªæ˜¯ï¼š
  - å°†åŠŸèƒ½åˆ†æ•£åˆ°å¤šä¸ª MCP Server
  - æ¯ä¸ª Server ä¸“æ³¨äºè‡ªå·±çš„èŒè´£
  - é€šè¿‡å®¢æˆ·ç«¯è¿›è¡Œåè°ƒå’Œç»„åˆ
```

#### å‘½åå»ºè®®

**å¯¹å¤–å®£ä¼ **ï¼š
```
"Arthas æ”¯æŒæ··åˆ MCP æ¶æ„ï¼Œå¯ä»¥å°†è¯Šæ–­å·¥å…·éƒ¨ç½²åœ¨æœ¬åœ°ï¼Œ
 å°†è¯Šæ–­çŸ¥è¯†éƒ¨ç½²åœ¨äº‘ç«¯ï¼Œå®ç°çµæ´»çš„èƒ½åŠ›ç»„åˆã€‚"
```

**æŠ€æœ¯æ–‡æ¡£**ï¼š
```
Architecture: Arthas Hybrid MCP Architecture
Components:
  - Arthas MCP Server (Local Tools Provider)
  - Arthas Agent MCP Server (Remote Knowledge Provider)
```

**ä»£ç æ³¨é‡Š**ï¼š
```java
/**
 * Arthas MCP Server - Local Tools Provider
 * 
 * This server provides diagnostic tools that directly interact with
 * the local JVM process. It focuses on "what can be done" rather than
 * "how to do it".
 * 
 * In the Arthas Hybrid MCP Architecture, this server works together
 * with the Remote Agent MCP Server, which provides diagnostic prompts
 * and knowledge resources.
 */
```

---

**æ–‡æ¡£ç»“æŸ**
